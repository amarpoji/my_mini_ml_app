
# My Mini ML App

Lightweight example app that trains a simple linear regression model (house price by size) and exposes a FastAPI HTTP API for predictions. This repository is prepared for deployment to AWS Elastic Beanstalk using the included `Procfile` and `gunicorn` + `uvicorn` worker.

**Quick Summary:**
- **Train:** `python model.py` creates `model.pkl` in the project root.
- **Run locally (dev):** `uvicorn application:application --host 0.0.0.0 --port 5000 --reload`
- **Production (EB):** Uses `Procfile` which runs `gunicorn -w 4 -k uvicorn.workers.UvicornWorker application:application`.

**Project Structure**

- `application.py`: FastAPI app (must expose `application` for Elastic Beanstalk).
- `model.py`: Simple training script — trains and writes `model.pkl`.
- `model.pkl`: Trained model artifact (generated by `model.py`). Commit this or ensure it exists before deploy.
- `Procfile`: Process definition used by Elastic Beanstalk.
- `requirements.txt`: Python dependencies.

**Requirements**

- Python 3.9+ (recommend 3.11)
- See `requirements.txt` (includes `fastapi`, `uvicorn`, `gunicorn`, `scikit-learn`).

**Setup (Windows PowerShell)**

1. Create virtual environment and activate:

```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
```

2. Install dependencies:

```powershell
pip install -r requirements.txt
```

3. Train the model (creates `model.pkl`):

```powershell
python model.py
```

Note: `model.py` saves `model.pkl` in the project root. Elastic Beanstalk will serve whatever model artifact is present in the source bundle you deploy. Either commit `model.pkl` to the repo or add a build/deploy script that trains the model on the instance.

**Run Locally**

For development (auto-reload):

```powershell
uvicorn application:application --host 0.0.0.0 --port 5000 --reload
```

Test endpoints:

- Health: `GET /health` → `http://localhost:5000/health`
- Root: `GET /` → `http://localhost:5000/`
- Predict: `GET /predict?size=1200` → returns JSON with `predicted_price`.

To run with the same server command EB uses (no reload):

```powershell
gunicorn -w 4 -k uvicorn.workers.UvicornWorker application:application
```

**Deploy to AWS Elastic Beanstalk**

Prerequisites:
- AWS account and credentials configured (use `aws configure` or set env vars).
- Install the Elastic Beanstalk CLI (`eb`).

Typical steps:

```powershell
# initialize in the repository (choose Python platform, e.g. python-3.11)
eb init -p python-3.11 my-mini-ml-app

# create an environment (first time)
eb create my-mini-ml-env

# deploy current commit
eb deploy

# open the app in the browser
eb open

# check status or logs
eb status
eb logs
```

Notes and recommendations:
- Ensure `model.pkl` is present in the repo or included in the source bundle before `eb deploy`.
- The `Procfile` is configured to run `gunicorn` with `uvicorn` workers, which is a common setup for running FastAPI on EB.
- Choose the EB platform that matches your Python version (`python-3.11`, etc.).

**Environment variables & config**

- If you need to use secrets (API keys, DB credentials), configure them in the EB console or using `eb setenv KEY=VALUE`.
- To customize platform settings, use `.ebextensions` or the EB console.

**Troubleshooting**

- If the app fails to start on EB, check `eb logs` and the `web` process logs.
- A common cause is a missing `model.pkl`; the app expects `model.pkl` at the project root and will attempt to `pickle.load` it on startup.
- If you see dependency issues, ensure `requirements.txt` pins compatible versions and re-run `pip install -r requirements.txt` locally to reproduce.

**Testing the deployed app**

Once deployed, call the predict endpoint in your browser or using `curl` / `Invoke-RestMethod`:

```powershell
Invoke-RestMethod "${env:EB_APP_URL:-http://your-eb-url}/predict?size=1200"
```

or with curl:

```bash
curl "http://your-eb-url/predict?size=1200"
```


